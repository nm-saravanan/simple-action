name: Docker hub login 
on: [push]

jobs:
  run-shell-command:
    runs-on: ubuntu-latest
    steps:
     - name: Login to DockerHub
       uses: docker/login-action@v1 
       with:
          username: ${{ secrets.DOCKER_HUB_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
     #- name: Docker pull
      # run: docker pull registry.hub.docker.com/library/alpine
     - name: Checkout
       uses: actions/checkout@v2 
     - name: install kubectl
       run: |
        curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x ./kubectl
        sudo mv ./kubectl /usr/local/bin/kubectl
        kubectl version --client
        kubectl config view
     - name: install minikube
       run: |
         curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 && chmod +x minikube
         sudo install minikube /usr/local/bin
         minikube version
         minikube start
     - name: Apply k8s config
       run: |
         kubectl apply -f ./k8s 
     - name: Cloud SDK distribution URI as a package source
       run: |
         echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
         sudo apt-get install apt-transport-https ca-certificates gnupg
         curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
         sudo apt-get update && sudo apt-get install google-cloud-sdk
         gcloud init
    